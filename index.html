
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="about/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>MaxText Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#maxtext" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="MaxText Documentation" class="md-header__button md-logo" aria-label="MaxText Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MaxText Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="about/" class="md-tabs__link">
        
  
    
  
  What is Maxtext?

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="getting_started/First_run/" class="md-tabs__link">
          
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="getting_started/Run_MaxText_via_multihost_job/" class="md-tabs__link">
          
  
  Advanced usage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="reference/code_organization/" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="MaxText Documentation" class="md-nav__button md-logo" aria-label="MaxText Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MaxText Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-performance-results" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Performance Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime Performance Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tpu-v5p" class="md-nav__link">
    <span class="md-ellipsis">
      TPU v5p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tpu-v5e" class="md-nav__link">
    <span class="md-ellipsis">
      TPU v5e
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-to-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison to Alternatives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-and-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      Features and Diagnostics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Features and Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collect-stack-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Collect Stack Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ahead-of-time-compilation-aot" class="md-nav__link">
    <span class="md-ellipsis">
      Ahead of Time Compilation (AOT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ahead of Time Compilation (AOT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tpu-support" class="md-nav__link">
    <span class="md-ellipsis">
      TPU Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TPU Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-aot-1-compile-ahead-of-time-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Example AOT 1: Compile ahead of time basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-aot-2-save-compiled-function-then-load-and-run-it" class="md-nav__link">
    <span class="md-ellipsis">
      Example AOT 2: Save compiled function, then load and run it
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu-support" class="md-nav__link">
    <span class="md-ellipsis">
      GPU Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPU Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatically-upload-logs-to-vertex-tensorboard" class="md-nav__link">
    <span class="md-ellipsis">
      Automatically Upload Logs to Vertex Tensorboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is Maxtext?
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/First_run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/steps_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steps to build a Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.kaggle.com/code/melissawm/maxtext-examples" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Run_MaxText_via_multihost_job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run MaxText via multihost job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Run_MaxText_via_multihost_runner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run MaxText via multihost runner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Run_MaxText_via_xpk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run MaxText via xpk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Use_Vertex_AI_Tensorboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Vertex AI Tensorboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Run_Llama2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Llama2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="data_loading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Loading
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/code_organization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MaxText Code Organization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/config_options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Data_Input_Pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Input Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/Data_Input_Perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Input Perf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-performance-results" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Performance Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime Performance Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tpu-v5p" class="md-nav__link">
    <span class="md-ellipsis">
      TPU v5p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tpu-v5e" class="md-nav__link">
    <span class="md-ellipsis">
      TPU v5e
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-to-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison to Alternatives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-and-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      Features and Diagnostics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Features and Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collect-stack-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Collect Stack Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ahead-of-time-compilation-aot" class="md-nav__link">
    <span class="md-ellipsis">
      Ahead of Time Compilation (AOT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ahead of Time Compilation (AOT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tpu-support" class="md-nav__link">
    <span class="md-ellipsis">
      TPU Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TPU Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-aot-1-compile-ahead-of-time-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Example AOT 1: Compile ahead of time basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-aot-2-save-compiled-function-then-load-and-run-it" class="md-nav__link">
    <span class="md-ellipsis">
      Example AOT 2: Save compiled function, then load and run it
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu-support" class="md-nav__link">
    <span class="md-ellipsis">
      GPU Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPU Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatically-upload-logs-to-vertex-tensorboard" class="md-nav__link">
    <span class="md-ellipsis">
      Automatically Upload Logs to Vertex Tensorboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<!--
 Copyright 2024 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 -->

<h1 id="maxtext">MaxText</h1>
<p><a href="https://github.com/google/maxtext/actions/workflows/UnitTests.yml"><img alt="Unit Tests" src="https://github.com/google/maxtext/actions/workflows/UnitTests.yml/badge.svg" /></a></p>
<h2 id="overview">Overview</h2>
<p>MaxText is a <strong>high performance</strong>, <strong>highly scalable</strong>, <strong>open-source</strong> LLM written in pure Python/Jax and targeting Google Cloud TPUs and GPUs for <strong>training</strong> and <strong>inference</strong>. MaxText achieves <a href="#runtime-performance-results">high MFUs</a> and scales from single host to very large clusters while staying simple and "optimization-free" thanks to the power of Jax and the XLA compiler.</p>
<p>MaxText aims to be a launching off point for ambitious LLM projects both in research and production. We encourage users to start by experimenting with MaxText out of the box and then fork and modify MaxText to meet their needs.</p>
<p>We have used MaxText to <a href="https://cloud.google.com/blog/products/compute/accurate-quantized-training-aqt-for-tpu-v5e">demonstrate high-performance, well-converging training in int8</a> and <a href="https://cloud.google.com/blog/products/compute/the-worlds-largest-distributed-llm-training-job-on-tpu-v5e">scale training to ~51K chips</a>.</p>
<p>Key supported features:
* TPUs and GPUs (in preview)
* Training and Inference (in preview)
* Models: Llama2, Mistral and Gemma</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="getting_started/First_run/">Getting Started</a></li>
<li><a href="#runtime-performance-results">Runtime Performance Results</a></li>
<li><a href="#comparison-to-alternatives">Comparison To Alternatives</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#features-and-diagnostics">Features and Diagnostics</a></li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>For your first time running MaxText, we provide specific <a href="getting_started/First_run/">instructions</a>.</p>
<p>MaxText supports training and inference of various open models. Follow user guides in the <a href="getting_started">getting started</a> folder to know more.</p>
<p>Some extra helpful guides:
* <a href="https://ai.google.dev/gemma">Gemma</a>: a family of open-weights Large Language Model (LLM) by <a href="https://deepmind.google/">Google DeepMind</a>, based on Gemini research and technology. You can run decode and finetuning using <a href="end_to_end/tpu/gemma/Run_Gemma.md">these instructions</a>.
* <a href="https://llama.meta.com/llama2/">Llama2</a>: a family of open-weights Large Language Model (LLM) by Meta. You can run decode and finetuning using <a href="getting_started/Run_Llama2/">these instructions</a>.
* <a href="https://mistral.ai/news/mixtral-of-experts/">Mixtral</a>: a family of open-weights sparse mixture-of-experts (MoE) model by Mistral AI. You can run decode and finetuning using <a href="end_to_end/tpu/mixtral/Run_Mixtral.md">these instructions</a></p>
<p>In addition to the getting started guides, there are always other MaxText capabilities that are being constantly being added! The full suite of end-to-end tests is in <a href="end_to_end">end_to_end</a>. We run them with a nightly cadence. They can be a good source for understanding MaxText Alternatively you can see the continuous <a href=".github/workflows/UnitTests.yml">unit tests</a> which are run almost continuously.</p>
<h2 id="runtime-performance-results">Runtime Performance Results</h2>
<p>More details on reproducing these results can be found in <a href="MaxText/configs/README.md">MaxText/configs/README.md</a>.</p>
<h3 id="tpu-v5p">TPU v5p</h3>
<table>
<thead>
<tr>
<th>No. of params</th>
<th>Accelerator Type</th>
<th>TFLOP/chip/sec</th>
<th>Model flops utilization (MFU)</th>
</tr>
</thead>
<tbody>
<tr>
<td>32B</td>
<td>v5p-128</td>
<td>3.28e+02</td>
<td>71.47%</td>
</tr>
<tr>
<td>64B</td>
<td>v5p-128</td>
<td>3.23e+02</td>
<td>70.31%</td>
</tr>
<tr>
<td>128B</td>
<td>v5p-256</td>
<td>3.15e+02</td>
<td>68.68%</td>
</tr>
<tr>
<td>128B</td>
<td>v5p-512</td>
<td>3.15e+02</td>
<td>68.53%</td>
</tr>
<tr>
<td>256B</td>
<td>v5p-1024</td>
<td>3.16e+02</td>
<td>68.82%</td>
</tr>
<tr>
<td>512B</td>
<td>v5p-1024</td>
<td>2.94e+02</td>
<td>63.99%</td>
</tr>
<tr>
<td>1024B</td>
<td>v5p-2048</td>
<td>2.49e+02</td>
<td>64.05%</td>
</tr>
<tr>
<td>1024B</td>
<td>v5p-4096</td>
<td>2.97e+02</td>
<td>64.80%</td>
</tr>
<tr>
<td>1160B</td>
<td>v5p-7680</td>
<td>2.95e+02</td>
<td>64.27%</td>
</tr>
<tr>
<td>1160B</td>
<td>v5p-12288</td>
<td>3.04e+02</td>
<td>66.23%</td>
</tr>
</tbody>
</table>
<h3 id="tpu-v5e">TPU v5e</h3>
<p>For 16B, 32B, 64B, and 128B models. See full run configs in <a href="MaxText/configs/v5e/">MaxText/configs/v5e/</a> as <code>16b.sh</code>, <code>32b.sh</code>, <code>64b.sh</code>, <code>128b.sh</code>.</p>
<table>
<thead>
<tr>
<th>Hardware</th>
<th style="text-align: right;">16B TFLOP/sec/chip</th>
<th>16B MFU</th>
<th style="text-align: right;">32B TFLOP/sec/chip</th>
<th>32B MFU</th>
<th style="text-align: right;">64B TFLOP/sec/chip</th>
<th>64B MFU</th>
<th style="text-align: right;">128B TFLOP/sec/chip</th>
<th>128B MFU</th>
</tr>
</thead>
<tbody>
<tr>
<td>1x v5e-256</td>
<td style="text-align: right;">120</td>
<td>61.10%</td>
<td style="text-align: right;">132</td>
<td>66.86%</td>
<td style="text-align: right;">118</td>
<td>59.90%</td>
<td style="text-align: right;">110</td>
<td>56.06%</td>
</tr>
<tr>
<td>2x v5e-256</td>
<td style="text-align: right;">117</td>
<td>59.37%</td>
<td style="text-align: right;">128</td>
<td>64.81%</td>
<td style="text-align: right;">112</td>
<td>56.66%</td>
<td style="text-align: right;">110</td>
<td>55.82%</td>
</tr>
<tr>
<td>4x v5e-256</td>
<td style="text-align: right;">117</td>
<td>59.14%</td>
<td style="text-align: right;">126</td>
<td>64.10%</td>
<td style="text-align: right;">110</td>
<td>55.85%</td>
<td style="text-align: right;">108</td>
<td>54.93%</td>
</tr>
<tr>
<td>8x v5e-256</td>
<td style="text-align: right;">115</td>
<td>58.27%</td>
<td style="text-align: right;">125</td>
<td>63.67%</td>
<td style="text-align: right;">108</td>
<td>54.96%</td>
<td style="text-align: right;">104</td>
<td>52.93%</td>
</tr>
<tr>
<td>16x v5e-256</td>
<td style="text-align: right;">111</td>
<td>56.56%</td>
<td style="text-align: right;">123</td>
<td>62.26%</td>
<td style="text-align: right;">105</td>
<td>53.29%</td>
<td style="text-align: right;">100</td>
<td>50.86%</td>
</tr>
<tr>
<td>32x v5e-256</td>
<td style="text-align: right;">108</td>
<td>54.65%</td>
<td style="text-align: right;">119</td>
<td>60.40%</td>
<td style="text-align: right;">99</td>
<td>50.18%</td>
<td style="text-align: right;">91</td>
<td>46.25%</td>
</tr>
</tbody>
</table>
<h2 id="comparison-to-alternatives">Comparison to Alternatives</h2>
<p>MaxText is heavily inspired by <a href="https://github.com/karpathy/minGPT">MinGPT</a>/<a href="https://github.com/karpathy/nanoGPT">NanoGPT</a>, elegant standalone GPT implementations written in PyTorch and targeting Nvidia GPUs. MaxText is more complex, supporting more industry standard models and scaling to tens of thousands of chips. Ultimately MaxText has an MFU more than three times the <a href="https://twitter.com/karpathy/status/1613250489097027584?cxt=HHwWgIDUhbixteMsAAAA">17%</a> reported most recently with that codebase, is massively scalable and implements a key-value cache for efficient auto-regressive decoding.</p>
<p>MaxText is more similar to <a href="https://github.com/NVIDIA/Megatron-LM">Nvidia/Megatron-LM</a>, a very well tuned LLM implementation targeting Nvidia GPUs. The two implementations achieve comparable MFUs. The difference in the codebases highlights the different programming strategies. MaxText is pure Python, relying heavily on the XLA compiler to achieve high performance. By contrast, Megatron-LM is a mix of Python and CUDA, relying on well-optimized CUDA kernels to achieve high performance.</p>
<p>MaxText is also comparable to <a href="https://github.com/google/paxml">Pax</a>. Like Pax, MaxText provides high-performance and scalable implementations of LLMs in Jax. Pax focuses on enabling powerful configuration parameters, enabling developers to change the model by editing config parameters. By contrast, MaxText is a simple, concrete implementation of various LLMs that encourages users to extend by forking and directly editing the source code.</p>
<h2 id="features-and-diagnostics">Features and Diagnostics</h2>
<h3 id="collect-stack-traces">Collect Stack Traces</h3>
<p>When running a Single Program, Multiple Data (SPMD) job on accelerators, the overall process can hang if there is any error or any VM hangs/crashes for some reason. In this scenario, capturing stack traces will help to identify and troubleshoot the issues for the jobs running on TPU VMs.</p>
<p>The following configurations will help to debug a fault or when a program is stuck or hung somewhere by collecting stack traces. Change the parameter values accordingly in <code>MaxText/configs/base.yml</code>:
1. Set <code>collect_stack_trace: True</code> to enable collection of stack traces on faults or when the program is hung. This setting will periodically dump the traces for the program to help in debugging. To disable this, set <code>collect_stack_trace: False</code>.
2. Set <code>stack_trace_to_cloud: False</code> to display stack traces on console. <code>stack_trace_to_cloud: True</code> will create a temporary file in <code>/tmp/debugging</code> in the TPUs to store the stack traces. There is an agent running on TPU VMs that will periodically upload the traces from the temporary directory to cloud logging in the gcp project. You can view the traces in Logs Explorer on Cloud Logging using the following query:</p>
<pre><code>logName=&quot;projects/&lt;project_name&gt;/logs/tpu.googleapis.com%2Fruntime_monitor&quot;
jsonPayload.verb=&quot;stacktraceanalyzer&quot;
</code></pre>
<ol>
<li><code>stack_trace_interval_seconds</code> signifies the duration in seconds between each stack trace collection event. Setting <code>stack_trace_interval_seconds: 600</code> will collect the stack traces every 600 seconds (10 minutes).</li>
</ol>
<p>Here is the related PyPI package: https://pypi.org/project/cloud-tpu-diagnostics.</p>
<h3 id="ahead-of-time-compilation-aot">Ahead of Time Compilation (AOT)</h3>
<p>To compile your training run ahead of time, we provide a tool <code>train_compile.py</code>. This tool allows you to compile the main <code>train_step</code> in <code>train.py</code> for target hardware (e.g. a large number of v5e devices) without using the full cluster.</p>
<h4 id="tpu-support">TPU Support</h4>
<p>You may use only a CPU or a single VM from a different family to pre-compile for a TPU cluster. This compilation helps with two main goals:</p>
<ul>
<li>
<p>It will flag any out of memory (OOM) information, such as when the <code>per_device_batch_size</code> is set too high, with an identical OOM stack trace as if it was compiled on the target hardware.</p>
</li>
<li>
<p>The ahead of time compilation can be saved and then loaded for fast startup and restart times on the target hardware.</p>
</li>
</ul>
<p>The tool <code>train_compile.py</code> is tightly linked to <code>train.py</code> and uses the same configuration file <code>configs/base.yml</code>. Although you don't need to run on a TPU, you do need to install <code>jax[tpu]</code> in addition to other dependencies, so we recommend running <code>setup.sh</code> to install these if you have not already done so.</p>
<h5 id="example-aot-1-compile-ahead-of-time-basics">Example AOT 1: Compile ahead of time basics</h5>
<p>After installing the dependencies listed above, you are ready to compile ahead of time:</p>
<pre><code># Run the below on a single machine, e.g. a CPU
python3 MaxText/train_compile.py MaxText/configs/base.yml compile_topology=v5e-256 compile_topology_num_slices=2 \
global_parameter_scale=16 per_device_batch_size=4
</code></pre>
<p>This will compile a 16B parameter MaxText model on 2 v5e pods.</p>
<h5 id="example-aot-2-save-compiled-function-then-load-and-run-it">Example AOT 2: Save compiled function, then load and run it</h5>
<p>Here is an example that saves then loads the compiled <code>train_step</code>, starting with the save:</p>
<p><strong>Step 1: Run AOT and save compiled function</strong></p>
<pre><code># Run the below on a single machine, e.g. a CPU
export LIBTPU_INIT_ARGS=&quot;--xla_enable_async_all_gather=true&quot;
python3 MaxText/train_compile.py MaxText/configs/base.yml compile_topology=v5e-256 \
compile_topology_num_slices=2 \
compiled_trainstep_file=my_compiled_train.pickle global_parameter_scale=16 \
per_device_batch_size=4 steps=10000 learning_rate=1e-3
</code></pre>
<p><strong>Step 2: Run train.py and load the compiled function</strong></p>
<p>To load the compiled train_step, you just need to pass <code>compiled_trainstep_file=my_compiled_train.pickle</code> into <code>train.py</code>:</p>
<pre><code># Run the below on each host of the target hardware, e.g. each host on 2 slices of v5e-256
export LIBTPU_INIT_ARGS=&quot;--xla_enable_async_all_gather=true&quot;
python3 MaxText/train.py MaxText/configs/base.yml run_name=example_load_compile \
compiled_trainstep_file=my_compiled_train.pickle \
global_parameter_scale=16  per_device_batch_size=4 steps=10000 learning_rate=1e-3 \
base_output_directory=gs://my-output-bucket dataset_path=gs://my-dataset-bucket
</code></pre>
<p>In the save step of example 2 above we included exporting the compiler flag <code>LIBTPU_INIT_ARGS</code> and <code>learning_rate</code> because those affect the compiled object <code>my_compiled_train.pickle.</code> The sizes of the model (e.g. <code>global_parameter_scale</code>, <code>max_sequence_length</code> and <code>per_device_batch</code>) are fixed when you initially compile via <code>compile_train.py</code>, you will see a size error if you try to run the saved compiled object with different sizes than you compiled with. However a subtle note is that the <strong>learning rate schedule</strong> is also fixed when you run <code>compile_train</code> - which is determined by both <code>steps</code> and <code>learning_rate</code>. The optimizer parameters such as  <code>adam_b1</code> are passed only as shaped objects to the compiler - thus their real values are determined when you run <code>train.py</code>, not during the compilation. If you do pass in different shapes (e.g. <code>per_device_batch</code>), you will get a clear error message reporting that the compiled signature has different expected shapes than what was input. If you attempt to run on different hardware than the compilation targets requested via <code>compile_topology</code>, you will get an error saying there is a failure to map the devices from the compiled to your real devices. Using different XLA flags or a LIBTPU than what was compiled will probably run silently with the environment you compiled in without error. However there is no guaranteed behavior in this case; you should run in the same environment you compiled in.</p>
<h4 id="gpu-support">GPU Support</h4>
<p>Ahead-of-time compilation is also supported for GPUs with some differences from TPUs: </p>
<ol>
<li>
<p>GPU does not support compilation across hardware: A GPU host is still required to run AoT compilation, but a single GPU host can compile a program for a larger cluster of the same hardware.</p>
</li>
<li>
<p>For <a href="https://cloud.google.com/compute/docs/gpus#h100-gpus">A3 Cloud GPUs</a>, the maximum "slice" size is a single host, and the <code>compile_topology_num_slices</code> parameter represents the number of A3 machines to precompile for.</p>
</li>
</ol>
<h5 id="example">Example</h5>
<p>This example illustrates the flags to use for a multihost GPU compilation targeting a cluster of 4 A3 hosts:</p>
<p><strong>Step 1: Run AOT and save compiled function</strong></p>
<pre><code># Run the below on a single A3 machine
export XLA_FLAGS=&quot;--xla_gpu_enable_async_collectives=true&quot;
python3 MaxText/train_compile.py MaxText/configs/base.yml compile_topology=a3 \
compile_topology_num_slices=4 \
compiled_trainstep_file=my_compiled_train.pickle global_parameter_scale=16 \
attention=dot_product per_device_batch_size=4 steps=10000 learning_rate=1e-3
</code></pre>
<p><strong>Step 2: Run train.py and load the compiled function</strong></p>
<p>To load the compiled train_step, you just need to pass <code>compiled_trainstep_file=my_compiled_train.pickle</code> into <code>train.py</code>:</p>
<pre><code># Run the below on each of the 4 target A3 hosts.
export XLA_FLAGS=&quot;--xla_gpu_enable_async_collectives=true&quot;
python3 MaxText/train.py MaxText/configs/base.yml run_name=example_load_compile \
compiled_trainstep_file=my_compiled_train.pickle \
attention=dot_product global_parameter_scale=16  per_device_batch_size=4 steps=10000 learning_rate=1e-3 \
base_output_directory=gs://my-output-bucket dataset_path=gs://my-dataset-bucket
</code></pre>
<p>As in the TPU case, note that the compilation environment must match the execution environment, in this case by setting the same <code>XLA_FLAGS</code>.</p>
<h3 id="automatically-upload-logs-to-vertex-tensorboard">Automatically Upload Logs to Vertex Tensorboard</h3>
<p>MaxText supports automatic upload of logs collected in a directory to a Tensorboard instance in Vertex AI. Follow <a href="getting_started/Use_Vertex_AI_Tensorboard/">user guide</a> to know more.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.expand"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>
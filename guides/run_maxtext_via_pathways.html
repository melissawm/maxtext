
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Guide: Running MaxText via Pathways &#8212; MaxText  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=95a5a69d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=c73c0f3e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'guides/run_maxtext_via_pathways';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Manage the data input pipeline" href="data_input_pipeline.html" />
    <link rel="prev" title="Running MaxText at Scale with XPK" href="run_maxtext_via_xpk.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/maxtext.png" class="logo__image only-light" alt="MaxText  documentation - Home"/>
    <script>document.write(`<img src="../_static/maxtext.png" class="logo__image only-dark" alt="MaxText  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    MaxText
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/first_run.html">Getting Started: First Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/pretraining.html">Pretraining with real datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/full_finetuning.html">Full Finetuning LLama3-8B  Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/run_llama2.html">About Llama2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/grpo.html">Try GRPO!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/sft.html">Try SFT!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/sft_on_multi_host.html">Supervised Fine-Tuning (SFT) with Deepseek-V3 Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/grpo_with_pathways.html">Try GRPO with Pathways!</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../guides.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="checkpoints.html">Checkpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_model.html">How to customize your model configs on TPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_maxtext_localhost.html">Run MaxText on Localhost or Single Host VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_maxtext_via_xpk.html">Running MaxText at Scale with XPK</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Guide: Running MaxText via Pathways</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="data_input_pipeline.html">Manage the data input pipeline</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="data_input_grain.html">Grain pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_input_hf.html">Hugging Face pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_input_tfds.html">TFDS pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="single_host_gpu.html">Maxtext on Single host GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="knowledge_distillation.html">Knowledge Distillation</a></li>
<li class="toctree-l2"><a class="reference internal" href="gcp_workload_observability.html">Enable GCP Workload Observabiltiy</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitor_goodput.html">ML Goodput Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_vertex_ai_tensorboard.html">Use Vertex AI Tensorboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="features_and_diagnostics.html">Features and Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="pallas_kernels_performance.html">Performance Optimizations with Pallas Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance_metrics.html">Performance Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="understand_logs_and_metrics.html">Understand Logs and Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkpointing_solutions/gcs_checkpointing.html">GCS bucket-based checkpointing</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkpointing_solutions/emergency_checkpointing.html">Emergency Checkpointing</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkpointing_solutions/multi_tier_checkpointing.html">Multi-Tier Checkpointing</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax_ai_libraries_chosen.html">The JAX Ecosystem in MaxText: An Opinionated Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="xprof_user_guide.html">XProf for MaxText developers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations.html">Explanations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/steps_model.html">Steps to build a Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/quantization.html">Quantization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/sharding.html">Sharding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/data_pipeline_perf.html">Data input pipeline performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/tiling.html">Tiling</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference.html">Reference documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/terminology.html">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/supported_models_and_architectures.html">Supported Models &amp; Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/alternatives.html">Comparison to Alternatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/benchmark_and_performance.html">Benchmark and Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/architecture_overview.html">MaxText architecture overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/jax_xla_and_pallas.html">JAX, XLA, and Pallas for MaxText users</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">How to Contribute</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AI-Hypercomputer/maxtext" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/guides/run_maxtext_via_pathways.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Guide: Running MaxText via Pathways</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-configuration">2. Environment configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-batch-workload">3. Running a Batch workload</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#submit-the-batch-workload">Submit the Batch Workload</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verify-the-workload">Verify the workload</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-headless-interactive-workload">4. Running a headless (interactive) workload</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-start-the-headless-service">Step 1: Start the headless service</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-connect-to-the-cluster-via-port-forwarding">Step 2: Connect to the cluster via port forwarding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-your-maxtext-script-locally">Step 3: Run Your MaxText script locally</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-information">More information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <!--
 Copyright 2023–2025 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<section class="tex2jax_ignore mathjax_ignore" id="guide-running-maxtext-via-pathways">
<span id="run-pathways"></span><h1>Guide: Running MaxText via Pathways<a class="headerlink" href="#guide-running-maxtext-via-pathways" title="Link to this heading">#</a></h1>
<p>This guide provides a comprehensive walkthrough for running MaxText workloads on a Google Kubernetes Engine (GKE) cluster using Pathways. Pathways acts as a powerful orchestrator for large-scale JAX jobs on AI Hypercomputer infrastructure.</p>
<p>This document assumes you have already created a Pathways GKE cluster using <code class="docutils literal notranslate"><span class="pre">xpk</span></code>. If you haven’t, follow the instructions at the <a class="reference external" href="https://cloud.google.com/ai-hypercomputer/docs/workloads/pathways-on-cloud/create-gke-cluster#xpk">Google Cloud Pathways &amp; XPK documentation</a>.</p>
<p>We will cover two primary modes of operation:</p>
<ul class="simple">
<li><p><strong>Batch workload</strong>: Ideal for long-running, non-interactive training jobs.</p></li>
<li><p><strong>Headless workload</strong>: Ideal for interactive development, debugging, and running code from a local machine or CPU VM.</p></li>
</ul>
<section id="prerequisites">
<h2>1. Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<p>Before you can run a MaxText workload, you must complete the following setup steps.</p>
<ol class="arabic">
<li><p><strong>Install XPK and its dependencies</strong>. Ensure that the <code class="docutils literal notranslate"><span class="pre">xpk</span></code> command-line tool is installed.</p></li>
<li><p><strong>Create a GKE cluster</strong> configured for Pathways.</p></li>
<li><p><strong>Build and upload a MaxText Docker image</strong> to your project’s Artifact Registry.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Build the Docker image for a TPU device</span>
<span class="c1"># This image contains MaxText and its dependencies.</span>
bash<span class="w"> </span>docker_build_dependency_image.sh<span class="w"> </span><span class="nv">DEVICE</span><span class="o">=</span>tpu<span class="w"> </span><span class="nv">MODE</span><span class="o">=</span>jax_ai_image<span class="w"> </span><span class="nv">BASEIMAGE</span><span class="o">=</span>us-docker.pkg.dev/cloud-tpu-images/jax-ai-image/tpu:latest

<span class="c1"># Step 2: Configure Docker to authenticate with Google Cloud</span>
gcloud<span class="w"> </span>auth<span class="w"> </span>configure-docker

<span class="c1"># Step 3: Upload the image to your project&#39;s registry</span>
<span class="c1"># Replace `$USER_runner` with your desired image name.</span>
bash<span class="w"> </span>docker_upload_runner.sh<span class="w"> </span><span class="nv">CLOUD_IMAGE_NAME</span><span class="o">=</span><span class="nv">$USER_runner</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="environment-configuration">
<h2>2. Environment configuration<a class="headerlink" href="#environment-configuration" title="Link to this heading">#</a></h2>
<p>The following commands use placeholder variables. Before running them, set these environment variables in your shell.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># -- Google Cloud Configuration --</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PROJECT</span><span class="o">=</span><span class="s2">&quot;your-gcp-project-id&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ZONE</span><span class="o">=</span><span class="s2">&quot;your-gcp-zone&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER</span><span class="o">=</span><span class="s2">&quot;your-gke-cluster-name&quot;</span>

<span class="c1"># -- Workload Configuration --</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WORKLOAD_NAME</span><span class="o">=</span><span class="s2">&quot;maxtext-job-</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d-%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TPU_TYPE</span><span class="o">=</span><span class="s2">&quot;v5p-8&quot;</span><span class="w"> </span><span class="c1"># Or your desired TPU type, e.g., v5e-4</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WORKLOAD_NODEPOOL_COUNT</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="c1"># Number of TPU slices for your job</span>

<span class="c1"># -- MaxText &amp; Storage Configuration --</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUCKET_NAME</span><span class="o">=</span><span class="s2">&quot;your-gcs-bucket-name&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RUN_NAME</span><span class="o">=</span><span class="s2">&quot;maxtext-run-1&quot;</span>
<span class="c1"># The Docker image you pushed in the prerequisite step</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_IMAGE</span><span class="o">=</span><span class="s2">&quot;gcr.io/</span><span class="si">${</span><span class="nv">PROJECT</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">_runner&quot;</span>
</pre></div>
</div>
</section>
<section id="running-a-batch-workload">
<h2>3. Running a Batch workload<a class="headerlink" href="#running-a-batch-workload" title="Link to this heading">#</a></h2>
<p>A batch workload runs entirely within the GKE cluster. You submit the job definition, and Pathways manages its execution.</p>
<section id="submit-the-batch-workload">
<h3>Submit the Batch Workload<a class="headerlink" href="#submit-the-batch-workload" title="Link to this heading">#</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">xpk</span> <span class="pre">workload</span> <span class="pre">create-pathways</span></code> command to start the job.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xpk<span class="w"> </span>workload<span class="w"> </span>create-pathways<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workload<span class="o">=</span><span class="nv">$WORKLOAD_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span><span class="nv">$CLUSTER</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--num-slices<span class="o">=</span><span class="nv">$WORKLOAD_NODEPOOL_COUNT</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tpu-type<span class="o">=</span><span class="nv">$TPU_TYPE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--project<span class="o">=</span><span class="nv">$PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--zone<span class="o">=</span><span class="nv">$ZONE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--docker-image<span class="o">=</span><span class="si">${</span><span class="nv">DOCKER_IMAGE</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--command<span class="o">=</span><span class="s2">&quot;python3 -m MaxText.train src/MaxText/configs/base.yml \</span>
<span class="s2">    base_output_directory=gs://</span><span class="si">${</span><span class="nv">BUCKET_NAME</span><span class="si">}</span><span class="s2"> \</span>
<span class="s2">    per_device_batch_size=1 \</span>
<span class="s2">    enable_checkpointing=false \</span>
<span class="s2">    dataset_type=synthetic \</span>
<span class="s2">    enable_single_controller=True \</span>
<span class="s2">    run_name=</span><span class="si">${</span><span class="nv">RUN_NAME</span><span class="si">}</span><span class="s2">-pathways-batch&quot;</span>
</pre></div>
</div>
</section>
<section id="verify-the-workload">
<h3>Verify the workload<a class="headerlink" href="#verify-the-workload" title="Link to this heading">#</a></h3>
<p>You can check the status of your running workloads with the <code class="docutils literal notranslate"><span class="pre">xpk</span> <span class="pre">workload</span> <span class="pre">list</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xpk<span class="w"> </span>workload<span class="w"> </span>list<span class="w"> </span>--cluster<span class="o">=</span><span class="nv">$CLUSTER</span><span class="w"> </span>--project<span class="o">=</span><span class="nv">$PROJECT</span><span class="w"> </span>--zone<span class="o">=</span><span class="nv">$ZONE</span>
</pre></div>
</div>
</section>
</section>
<section id="running-a-headless-interactive-workload">
<h2>4. Running a headless (interactive) workload<a class="headerlink" href="#running-a-headless-interactive-workload" title="Link to this heading">#</a></h2>
<p>A headless workload reserves TPUs on the cluster and sets up a controller, but the Python script itself runs on a separate machine, like a local laptop or a Compute Engine VM. This is useful for rapid development and debugging. The headless mode refers to launching the Pathways backend services, such as resource manager and IFRT proxy, without a predefined user-workload container.</p>
<section id="step-1-start-the-headless-service">
<h3>Step 1: Start the headless service<a class="headerlink" href="#step-1-start-the-headless-service" title="Link to this heading">#</a></h3>
<p>This command reserves the TPUs and starts the Pathways head service on the cluster. It will wait until the resources are ready.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xpk<span class="w"> </span>workload<span class="w"> </span>create-pathways<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--headless<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workload<span class="o">=</span><span class="si">${</span><span class="nv">WORKLOAD_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--num-slices<span class="o">=</span><span class="si">${</span><span class="nv">WORKLOAD_NODEPOOL_COUNT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tpu-type<span class="o">=</span><span class="si">${</span><span class="nv">TPU_TYPE</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--project<span class="o">=</span><span class="si">${</span><span class="nv">PROJECT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--zone<span class="o">=</span><span class="si">${</span><span class="nv">ZONE</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span><span class="si">${</span><span class="nv">CLUSTER</span><span class="si">}</span>
</pre></div>
</div>
</section>
<section id="step-2-connect-to-the-cluster-via-port-forwarding">
<h3>Step 2: Connect to the cluster via port forwarding<a class="headerlink" href="#step-2-connect-to-the-cluster-via-port-forwarding" title="Link to this heading">#</a></h3>
<p>On the machine where you will run your Python script, open a <strong>new terminal</strong> and create a secure tunnel to the cluster’s Pathways controller.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This command forwards local port 29000 to the controller pod in the cluster.</span>
<span class="c1"># It runs in the background.</span>
kubectl<span class="w"> </span>port-forward<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">WORKLOAD_NAME</span><span class="si">}</span>-pathways-head<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="m">29000</span>:29000<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
</section>
<section id="step-3-run-your-maxtext-script-locally">
<h3>Step 3: Run Your MaxText script locally<a class="headerlink" href="#step-3-run-your-maxtext-script-locally" title="Link to this heading">#</a></h3>
<p>With the port forward active, you can now run your MaxText script. The JAX environment variables direct it to connect to the TPUs through the tunnel.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set these environment variables to tell JAX how to connect to the TPUs</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">JAX_PLATFORMS</span><span class="o">=</span>proxy
<span class="nb">export</span><span class="w"> </span><span class="nv">JAX_BACKEND_TARGET</span><span class="o">=</span>grpc://127.0.0.1:29000

<span class="c1"># Run the training script</span>
python3<span class="w"> </span>-m<span class="w"> </span>MaxText.train<span class="w"> </span>src/MaxText/configs/base.yml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">base_output_directory</span><span class="o">=</span>gs://<span class="si">${</span><span class="nv">BUCKET_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">per_device_batch_size</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">enable_checkpointing</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">dataset_type</span><span class="o">=</span>synthetic<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">enable_single_controller</span><span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">run_name</span><span class="o">=</span><span class="si">${</span><span class="nv">RUN_NAME</span><span class="si">}</span>-pathways-headless
</pre></div>
</div>
<p>The output streams directly to your terminal, just as if you were running on a local accelerator.</p>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Permission Denied errors for Cloud Storage Bucket</strong>: Check that the service account used by your GKE nodes has “Storage Object Admin” permissions on your GCS bucket.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Image</span> <span class="pre">not</span> <span class="pre">found</span></code> or <code class="docutils literal notranslate"><span class="pre">ImagePullBackOff</span></code></strong>:</p>
<ul>
<li><p>Verify your <code class="docutils literal notranslate"><span class="pre">DOCKER_IMAGE</span></code> variable is correct.</p></li>
<li><p>Ensure you have successfully pushed the image to your project’s Artifact Registry.</p></li>
<li><p>Check that your GKE cluster has permissions to pull from the registry.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">port-forward</span></code> fails</strong>:</p>
<ul>
<li><p>Confirm that the pod from Step 1 is running (<code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">pods</span></code>). The name should match <code class="docutils literal notranslate"><span class="pre">${WORKLOAD_NAME}-pathways-head-0</span></code>.</p></li>
<li><p>Ensure you are authenticated with <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> and have the correct context set for your GKE cluster.</p></li>
</ul>
</li>
<li><p>Make sure you import pathwaysutils package and call <code class="docutils literal notranslate"><span class="pre">pathwaysutils.initialize()</span></code> in your script when running the workload</p></li>
</ul>
</section>
<section id="more-information">
<h2>More information<a class="headerlink" href="#more-information" title="Link to this heading">#</a></h2>
<p>For more advanced configurations and a deeper dive into the Pathways architecture, see the official <a class="reference external" href="https://cloud.google.com/ai-hypercomputer/docs/workloads/pathways-on-cloud/pathways-intro">Pathways on Cloud documentation</a>.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="run_maxtext_via_xpk.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Running MaxText at Scale with XPK</p>
      </div>
    </a>
    <a class="right-next"
       href="data_input_pipeline.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Manage the data input pipeline</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-configuration">2. Environment configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-batch-workload">3. Running a Batch workload</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#submit-the-batch-workload">Submit the Batch Workload</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verify-the-workload">Verify the workload</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-headless-interactive-workload">4. Running a headless (interactive) workload</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-start-the-headless-service">Step 1: Start the headless service</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-connect-to-the-cluster-via-port-forwarding">Step 2: Connect to the cluster via port forwarding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-your-maxtext-script-locally">Step 3: Run Your MaxText script locally</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-information">More information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MaxText developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Google LLC.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>